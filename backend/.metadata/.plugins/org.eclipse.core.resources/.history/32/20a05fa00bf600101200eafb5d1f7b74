	package com.oas.userservice;
	
	import com.fasterxml.jackson.databind.ObjectMapper;
	import com.jayway.jsonpath.JsonPath;
	import com.oas.userservice.model.LoginRequest;
	import com.oas.userservice.model.User;
	import org.junit.jupiter.api.MethodOrderer;
	import org.junit.jupiter.api.Order;
	import org.junit.jupiter.api.Test;
	import org.junit.jupiter.api.TestMethodOrder;
	import org.springframework.beans.factory.annotation.Autowired;
	import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
	import org.springframework.boot.test.context.SpringBootTest;
	import org.springframework.http.MediaType;
	import org.springframework.test.context.ActiveProfiles;
	import org.springframework.test.web.servlet.MockMvc;
	import org.springframework.test.web.servlet.MvcResult;
	
	import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
	import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;
	
	@SpringBootTest
	@AutoConfigureMockMvc
	@ActiveProfiles("test")
	class UserServiceApplicationTests {

	    @Autowired
	    MockMvc mockMvc;

	    @Autowired
	    ObjectMapper objectMapper;

	    @Autowired
	    UserRepository userRepository;

	    @BeforeEach
	    void cleanDb() {
	        userRepository.deleteAll();
	    }

	    @Test
	    void registerUser_shouldReturn201() throws Exception {
	        User user = new User();
	        user.setName("Rajat");
	        user.setEmail("rajat@test.com");
	        user.setPassword("123456");

	        mockMvc.perform(post("/api/auth/register")
	                .contentType(MediaType.APPLICATION_JSON)
	                .content(objectMapper.writeValueAsString(user)))
	                .andExpect(status().isCreated());
	    }

	    @Test
	    void loginUser_shouldReturnJwtToken() throws Exception {
	        registerUser_shouldReturn201();

	        LoginRequest request = new LoginRequest();
	        request.setEmail("rajat@test.com");
	        request.setPassword("123456");

	        mockMvc.perform(post("/api/auth/login")
	                .contentType(MediaType.APPLICATION_JSON)
	                .content(objectMapper.writeValueAsString(request)))
	                .andExpect(status().isOk())
	                .andExpect(jsonPath("$.token").exists());
	    }
	}
